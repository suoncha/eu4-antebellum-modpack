exploit_tax_every_province_effect = {
	set_variable = {
		which = total_tax_gain
		value = 0
	}
	every_owned_province = {
		limit = {
			is_core = FROM
			controlled_by = FROM
			has_siege = no
			base_tax = 2
			OR = {
				NOT = {
					has_province_flag = province_exploited
				}
				had_province_flag = {
					flag = province_exploited
					days = 7300
				}
			}
			if = {
				limit = {
					NOT = {
						FROM = {
							has_country_flag = exploit_in_territories
						}
					}
				}
				is_territory = no
			}
		}
		export_to_variable = {
			which = local_yearly_tax_income
			value = modifier:tax_income
		}
		export_to_variable = {
			which = local_base_tax
			value = trigger_value:base_tax
		}
		set_variable = {
			which = local_monthly_tax_income
			which = local_yearly_tax_income
		}
		change_variable = {
			which = local_monthly_tax_income
			which = local_base_tax
		}
		divide_variable = {
			which = local_monthly_tax_income
			value = 12
		}
		export_to_variable = {
			which = local_tax_mod
			value = modifier:local_tax_modifier
		}
		export_to_variable = {
			which = global_tax_mod
			value = modifier:global_tax_modifier
			who = FROM
		}
		set_variable = {
			which = tax_modifier
			which = global_tax_mod
		}
		change_variable = {
			which = tax_modifier
			which = local_tax_mod
		}
		multiply_variable = {
			which = local_monthly_tax_income
			which = tax_modifier
		}
		export_to_variable = {
			which = local_autonomy_raw
			value = local_autonomy
		}
		set_variable = {
			which = local_autonomy
			value = 100
		}
		subtract_variable = {
			which = local_autonomy
			which = local_autonomy_raw
		}
		divide_variable = {
			which = local_autonomy
			value = 100
		}
		multiply_variable = {
			which = local_monthly_tax_income
			which = local_autonomy
		}
		set_variable = {
			which = total_tax_gain
			which = local_monthly_tax_income
		}
		multiply_variable = {
			which = total_tax_gain
			value = 60
		}
		PREV = {
			change_variable = {
				which = total_tax_gain
				which = PREV
			}
		}
		add_base_tax = -1
		set_province_flag = province_exploited
		apply_exploit_tax_on_actions = yes
	}
	set_variable = {
		which = testing
		which = total_tax_gain
	}
	variable_effect = {
		var = testing
		effect = add_treasury
	}
}

exploit_production_every_province_effect = {
	set_variable = {
		which = total_sailors_gain
		value = 0
	}
	every_owned_province = {
		limit = {
			is_core = FROM
			controlled_by = FROM
			has_siege = no
			base_production = 2
			has_port = yes
			OR = {
				NOT = {
					has_province_flag = province_exploited
				}
				had_province_flag = {
					flag = province_exploited
					days = 7300
				}
			}
			if = {
				limit = {
					NOT = {
						FROM = {
							has_country_flag = exploit_in_territories
						}
					}
				}
				is_territory = no
			}
		}
		export_to_variable = {
			which = total_sailors_gain
			value = modifier:local_sailors
		}
		export_to_variable = {
			which = local_sailors_mod
			value = modifier:local_sailors_modifier
		}
		multiply_variable = {
			which = total_sailors_gain
			which = local_sailors_mod
		}
		export_to_variable = {
			which = local_autonomy_raw
			value = local_autonomy
		}
		set_variable = {
			which = local_autonomy
			value = 100
		}
		subtract_variable = {
			which = local_autonomy
			which = local_autonomy_raw
		}
		divide_variable = {
			which = local_autonomy
			value = 100
		}
		multiply_variable = {
			which = total_sailors_gain
			which = local_autonomy
		}
		divide_variable = {
			which = total_sailors_gain
			value = 120
		}
		multiply_variable = {
			which = total_sailors_gain
			value = 60
		}
		PREV = {
			change_variable = {
				which = total_sailors_gain
				which = PREV
			}
		}
		add_base_production = -1
		set_province_flag = province_exploited
		apply_exploit_production_on_actions = yes
	}
	round_variable = {
		which = total_sailors_gain
		value = -1
	}
	variable_effect = {
		var = total_sailors_gain
		effect = add_sailors
	}
}

exploit_manpower_every_province_effect = {
	set_variable = {
		which = total_manpower_gain
		value = 0
	}
	every_owned_province = {
		limit = {
			is_core = FROM
			controlled_by = FROM
			has_siege = no
			base_manpower = 2
			OR = {
				NOT = {
					has_province_flag = province_exploited
				}
				had_province_flag = {
					flag = province_exploited
					days = 7300
				}
			}
			if = {
				limit = {
					NOT = {
						FROM = {
							has_country_flag = exploit_in_territories
						}
					}
				}
				is_territory = no
			}
		}
		export_to_variable = {
			which = total_manpower_gain
			value = base_manpower
		}
		multiply_variable = {
			which = total_manpower_gain
			value = 250
		}
		export_to_variable = {
			which = additive_manpower
			value = modifier:local_manpower
		}
		multiply_variable = {
			which = additive_manpower
			value = 1000
		}
		change_variable = {
			which = total_manpower_gain
			which = additive_manpower
		}
		export_to_variable = {
			which = manpower_modifier
			value = modifier:local_manpower_modifier
		}
		export_to_variable = {
			which = country_manpower_modifier
			value = modifier:global_manpower_modifier
		}
		change_variable = {
			which = manpower_modifier
			which = country_manpower_modifier
			who = FROM
		}
		multiply_variable = {
			which = total_manpower_gain
			which = manpower_modifier
		}
		export_to_variable = {
			which = local_autonomy_raw
			value = local_autonomy
		}
		set_variable = {
			which = local_autonomy
			value = 100
		}
		subtract_variable = {
			which = local_autonomy
			which = local_autonomy_raw
		}
		divide_variable = {
			which = local_autonomy
			value = 100
		}
		multiply_variable = {
			which = total_manpower_gain
			which = local_autonomy
		}
		divide_variable = {
			which = total_manpower_gain
			value = 120
		}
		multiply_variable = {
			which = total_manpower_gain
			value = 60
		}
		round_variable = {
			which = total_manpower_gain
			value = 1
		}
		PREV = {
			change_variable = {
				which = total_manpower_gain
				which = PREV
			}
		}
		add_base_manpower = -1
		set_province_flag = province_exploited
		apply_exploit_manpower_on_actions = yes
	}
	set_variable = {
		which = manpower_to_gain
		which = total_manpower_gain
	}
	#add_manpower effect adds input*1000 manpower, so divide it by 1000.
	divide_variable = {
		which = manpower_to_gain
		value = 1000
	}
	variable_effect = {
		var = manpower_to_gain
		effect = add_manpower
	}
}

apply_exploit_tax_on_actions = {
	if = {
		limit = {
			owner = {
				has_government_attribute = may_not_reduce_tax_on_exploitation
			}
		}
		random = {
			chance = 50
			add_base_tax = 1
		}
	}
	if = {
		limit = {
			owner = {
				has_government_attribute = may_not_reduce_tax_on_own_exploitation
				culture_group = ROOT
			}
		}
		random = {
			chance = 25
			add_base_tax = 1
		}
	}
	if = {
		limit = {
			owner = {
				has_government_attribute = may_not_reduce_tax_on_foreign_exploitation
				NOT = {
					culture_group = ROOT
				}
			}
		}
		random = {
			chance = 50
			add_base_tax = 1
		}
	}
	if = {
		limit = {
			owner = {
				has_government_mechanic = blood_gathering_mechanic
			}
		}
		owner = {
			add_government_power = {
				mechanic_type = blood_gathering_mechanic
				power_type = blood
				value = 1
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = estate_burghers_hungarian_royal_city_modifier
			NOT = {
				development = 20
			}
		}
		remove_province_modifier = estate_burghers_hungarian_royal_city_modifier
	}
	if = {
		limit = {
			owner = {
				has_country_flag = terror_on_exploit
			}
		}
		owner = {
			change_terror = {
				value = 0.1
				scaled_with_gain_modifier = no
			}
		}
	}
}

apply_exploit_production_on_actions = {
	if = {
		limit = {
			owner = {
				has_government_mechanic = blood_gathering_mechanic
			}
		}
		owner = {
			add_government_power = {
				mechanic_type = blood_gathering_mechanic
				power_type = blood
				value = 1
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = estate_burghers_hungarian_royal_city_modifier
			NOT = {
				development = 20
			}
		}
		remove_province_modifier = estate_burghers_hungarian_royal_city_modifier
	}
	if = {
		limit = {
			owner = {
				has_country_flag = terror_on_exploit
			}
		}
		owner = {
			change_terror = {
				value = 0.1
				scaled_with_gain_modifier = no
			}
		}
	}
}

apply_exploit_manpower_on_actions = {
	if = {
		limit = {
			owner = {
				has_government_mechanic = blood_gathering_mechanic
			}
		}
		owner = {
			add_government_power = {
				mechanic_type = blood_gathering_mechanic
				power_type = blood
				value = 1
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = estate_burghers_hungarian_royal_city_modifier
			NOT = {
				development = 20
			}
		}
		remove_province_modifier = estate_burghers_hungarian_royal_city_modifier
	}
	if = {
		limit = {
			owner = {
				has_country_flag = terror_on_exploit
			}
		}
		owner = {
			change_terror = {
				value = 0.1
				scaled_with_gain_modifier = no
			}
		}
	}
}
